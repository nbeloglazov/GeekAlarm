# Server

Server application for GeekAlarm.

## Usage

Server handles following GET requests:

* **/tasks** - returns array of available tasks in json format:

```javascript
[{"name": "Determinant", "type": "determinant", "description": "Bla-bla-bla"},
 {"name": "Prime numbers", "type": "prime-numbers", "description": "Bla-bla-bla about prime numbers"}]
```

* **/task** - generates and returns task. Parameters:  
   *type* - type of the task  
   *level* - 1, 2 or 3  
   Example: /task?type=determinant&level=1  
   Result json object that contains task id and  index  of the correct answer (0 to 3):

```javascript
{"id": "01234567", "correct": 2}
```

* **/image** - returns image (for question or one of answers) for given task. Parameters:  
   *id* - task id  
   *type* - "question" or "choice"  
   *number* - number of choice if type is "choice"  
   Example: /image?id=01234567&type=choice&number=1  

## Architecture

Internally server works in following way:  

1. receives request to generate task.  
2. generates id and task. Task is generated by **task-manager**.  
3. adds task to map of active tasks. After predefined timeout (e.g. 10 min) task will be removed from map.  
4. return json with task's id and correct answer.  
5. receives request for image for this task.  
6. finds task in map and returns appropriate image.  

### task-manager
task-manager contains information of all tasks. Task consists of following fields: ```:name```, ```:type```, ```:description``` and ```:generator```. Generator - function that takes level (1, 2 or 3) and returns map with following keys: ```:question```, ```:choices```, ```:correct```.  
```:question``` - either InputStream of image or MathML expression (in cljml form). MathML expression will be rendered to image InputStream.  
```:choices```  - collection of InputStream's of images or MathML expressions.  
```:correct``` - index of correct answer  

## License

Copyright (C) 2011-2012 Nikita Beloglazov
